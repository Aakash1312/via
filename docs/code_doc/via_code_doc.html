<html>
  <head>
    <title>VIA Code Documentation</title>
  </head>

  <style type="text/css">
    body {
    font-family: Verdana, Helvetica, Sans;
    font-size: default;
    width: 60em;
    }
    h2 {
    font-size: xx-large;
    color: #0066ff;
    }
    h3 {
    font-size: large;
    }
    /* a block of code (html, css or javascript) */
    .code_block {
    font-family: Mono;
    font-size: default;
    width: 60em;
    border: 1px solid #e6e6e6;
    padding: 0;
    margin: 1em 0;
    overflow: auto;
    }

    a:link, a:visited {
    color: blue;
    }
    
    .code_block pre, code {
    font-family: Mono;
    font-size: default;
    margin: 0;
    }

    .code_block .title {
    display: block;    
    padding: 1em 1em;
    border-bottom: 1px solid #cccccc;
    }
    .code_block .title .backref {
    float: right;
    font-size: large;
    }
    .code_block .content {
    padding: 1em 2em;
    }
    .code_block .line {
    display: block;
    }
    .code_block .link {
    display: block;
    }
    .code_block .indent1 {
    padding-left: 1em;
    }
    .code_block .indent2 {
    padding-left: 2em;
    }

    /* figures for illustration */
    .figure {
    padding: 1em 2em;
    }

  </style>
  
  <body>
    <h1>VGG Image Annotator Code Documentation</h1>
    <p>VGG Image Annotator (VIA) application is contained in a single html file with definitions of
      CSS style and Javascript code blocks.</p>
    <p>The VIA application code has the following structure:</p>

    <div class="code_block">
      <div class="title">&lt;&lt;via.html&gt;&gt;=</div>
      <div class="content">
        <span class="link">[<a name="scld0" href="#scld1">source code license declaration</a>]</span>
        <span class="line">&nbsp;</span>
        
        <span class="line">&lt;html lang=&quot;en&quot;&gt;</span>
        <span class="line">&lt;head&gt;</span>
        
        <span class="link indent1">[<a name="hmtd0" href="#hmtd1">html meta tags definition</a>]</span>
        <span class="line">&nbsp;</span>
        
        <span class="line indent1">&lt;style type=&quot;text/css&quot;&gt;</span>
        <span class="link indent1">[<a name="csde0" href="">css definition</a>]</span>
        <span class="line indent1">&lt;/style&gt;</span>

        <span class="line">&lt;/head&gt;</span>
        <span class="line">&nbsp;</span>

        <span class="line">&lt;body onload=&quot;main()&quot; onresize=&quot;update_ui_components()&quot; &gt;</span>
        <span class="link indent1">[<a name="hcd0" href="#hcd1">html content definition</a>]</span>
        <span class="line">&nbsp;</span>
        
        <span class="line indent1">&lt;script type=&quot;text/javascript&quot;&gt;</span>
        <span class="link indent1">[<a name="vijd0" href="#vijd1">VIA javascript definition</a>]</span>
        <span class="line indent1">&lt;/script&gt;</span>

        <span class="line">&lt;/body&gt;</span>
        <span class="line">&lt;/html&gt;</span>
      </div>
    </div>
    
    <p>The <code>onload()</code> and <code>update_ui_components()</code> are defined
      in the <span class="link indent1">[<a name="csde0" href="">VIA javascript definition</a>]</span>
      code block and will be further described later.</p>

    <p>We define the standard html meta tags for this application as follows:</p>
    <div class="code_block" id="hmtd1">
      <div class="title">&lt;&lt;html meta tags definition&gt;&gt;= <span class="backref"><a href="#hmtd0">&uarr;</a></span></div>
      <div class="content">
        <span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span>
        <span class="line">&lt;title&gt;VGG Image Annotator&lt;/title&gt;</span>
        <span class="line">&lt;meta name=&quot;author&quot; content=&quot;Abhishek Dutta&quot;&gt;</span>
        <span class="line">&lt;meta name=&quot;description&quot; content=&quot;VGG Image Annotator (via) is a light-weight image annotation tool built solely using HTML, CSS and pure Javascript (not using any javascript libraries).&quot;&gt;</span>
      </div>
    </div>

    <div class="figure"><img src="./images/via_screenshot1.png" alt="VIA screenshot 1" /></div>
    <p>As shown in the above screenshot, there are many components of the
      VIA application. For example, the <code>#navbar</code> element provides
      the functionality of menu based navigation bar for this application.
      Similarly, the <code>#image_info</code> element shows information about
      the image currently being annotated. In this code documentation, we
      will focus on the HTML <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas" target="_new">canvas</a>
      element <code>#image_canvas</code> which displays the image being
      annotated and provides user interactions needed for image annotation.

    <div class="code_block" id="hcd1">
      <div class="title">&lt;&lt;html content definition&gt;&gt;= <span class="backref"><a href="#hcd0">&uarr;</a></span></div>
      <div class="content">
        <span class="line">...</span>
        <span class="line">&lt;div class=&quot;box&quot; id=&quot;image_panel&quot;&gt;</span>
        <span class="line indent1">&lt;canvas id=&quot;image_canvas&quot;&gt;Sorry, your browser does not support HTML5 Canvas functionality which is required for this application.&lt;/canvas&gt;</span>
        <span class="line">...</span>
      </div>
    </div>
This canvas' CSS definition is:
    <div class="code_block" id="csde1">
      <div class="title">&lt;&lt;css definition&gt;&gt;= <span class="backref"><a href="#csde0">&uarr;</a></span></div>
      <div class="content">
        <span class="line">...</span>
        <span class="line">#image_panel {</span>
        <span class="line indent1">display: inline-block;</span>
        <span class="line indent1">margin: auto;</span>
        <span class="line">}</span>
        <span class="line">...</span>
      </div>
    </div>

    <p>In the <a href="#via_js_def">Javascript Definition</a>, we describe the Javascript source code that handles user interactions with the canvas element.</p>

    <h2 id="via_js_def">Javascript Definition</h2>
    <p>Nearly 3000 lines of javascript source code is required to support
      all the functionalities provided by the VIA image annotator. A
      majority of this javascript is needed to support an interactive user
      interface. Only a small portion of this javascript code is needed to
      support the drawing, selection, resizing, deletion, etc. of image
      regions of varying shapes -- rectangle, circle, ellipse and polygon.</p>
    <p>We dissect and explain this javascript code in the following natural order of user interaction:</p>
    <div class="code_block" id="csde1">
      <div class="title">&lt;&lt;VIA javascript definition&gt;&gt;= <span class="backref"><a href="#vijd0">&uarr;</a></span></div>
      <div class="content">
        <span class="line">[<a name="glvd0" href="glvd1">global variables definition</a>]</span>
        <span class="line">&nbsp;</span>
        <span class="line">[<a name="lilf0" href="lilf1">loading images from local filesystem</a>]</span>
        <span class="line">[<a name="diic0" href="diic1">Displaying Image in Canvas</a>]</span>
        <span class="line">[<a name="drri0" href="drri1">Drawing Rectangular Regions on Image</a>]</span>
        <span class="line">[<a name="dara0" href="dara1">Defining and Adding Region Attributes</a>]</span>
        <span class="line">[<a name="exad0" href="exad1">Exporting the Annotation Data</a>]</span>
      </div>
    </div>

    <h3>1. Loading Images from Local Filesystem</h3>
    <div class="code_block" id="vijd1">
      <div class="title">&lt;&lt;&gt;&gt;= <span class="backref"><a href="#vijd0">&uarr;</a></span></div>
      <div class="content">
      </div>
    </div>

    <h3>2. Displaying Image in Canvas</h3>
    <h3>3. Drawing Rectangular Regions on Image</h3>
    <h3>4. Defining and Adding Region Attributes</h3>
    <h3>5. Exporting the Annotation Data</h3>
    
    
<h2>Source Code License</h2>
VIA is an open source project actively maintained by
the <a href="http://www.robots.ox.ac.uk/~vgg/">Visual Geometry Group (VGG)</a> at
Oxford University. Its source code is a distributed under the <a href="https://en.wikipedia.org/wiki/BSD_licenses#2-clause_license_.28.22Simplified_BSD_License.22_or_.22FreeBSD_License.22.29">BSD-2 clause license</a>
which means that you are free to not only use it or modify
it but also to contribute to this project.

<div class="code_block" id="scld1">
      <div class="title">&lt;&lt;source code license declaration&gt;&gt;= <span class="backref"><a href="#scld0">&uarr;</a></span></div>
      <div class="content">
<pre>
Copyright (c) 2016, Abhishek Dutta.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.
Redistributions in binary form must reproduce the above copyright notice,
this list of conditions and the following disclaimer in the documentation
and/or other materials provided with the distribution.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.
</pre>
      </div>
    </div>

  </body>
</html>

