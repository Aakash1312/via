<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"> 
    <!--
        VGG Image Annotator (via)
        www.robots.ox.ac.uk/~vgg/software/via/

        Copyright (c) 2016, Abhishek Dutta.
        All rights reserved.

        Redistribution and use in source and binary forms, with or without
        modification, are permitted provided that the following conditions are met:

        Redistributions of source code must retain the above copyright notice, this
        list of conditions and the following disclaimer.
        Redistributions in binary form must reproduce the above copyright notice,
        this list of conditions and the following disclaimer in the documentation
        and/or other materials provided with the distribution.
        THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
        AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
        IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
        ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
        LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
        CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
        SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
        INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
        CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
        ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
        POSSIBILITY OF SUCH DAMAGE.

      -->
    <title>VGG Image Annotator</title>
    <meta name="author" content="Abhishek Dutta">
    <meta name="description" content="VIA is a standalone image annotator application packaged as a single HTML file (< 200 KB) that runs on most modern web browsers.">

    <!-- Google analytics : used in Seebibyte project to measure impact
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-20555581-2', 'auto');
      ga('send', 'pageview');

    </script>
    -->
    
    
    <!-- CSS style definition -->
    <style type="text/css">     
      body {
      min-width: 800px;
      padding: 0;
      margin: 0;
      }
      
      /* Top panel : #navbar, #toolbar, #fileinfo */
      .top_panel {
      position: relative;
      top: 0;
      left: 0;
      display: block;
      font-family: Sans;
      background-color: #000000;
      color: white;
      z-index: 10;
      margin: 0;
      padding: 0;
      }

      .navbar {
      display: inline-block;
      font-size: small;
      }
      .navbar ul {
      display: inline;
      list-style-type: none;
      overflow: hidden;
      }
      .navbar li {
      float: left;
      }
      .navbar li a, .drop_menu_item {
      display: inline-block;
      color: white;
      padding: 0.4em 1.2em;
      text-decoration: none;
      }
      .navbar li a:hover, .dropdown:hover {
      background-color: #999999;
      cursor: pointer;
      }
      .navbar li.dropdown {
      display: inline-block;
      }
      .navbar .dropdown-content {
      display: none;
      position: absolute;
      background-color: #333333;
      min-width: 120px;
      border: 1px solid #ffffff;
      }
      .navbar .dropdown-content a {
      color: #ffffff;
      padding: 0.4em 0.6em;
      text-decoration: none;
      display: block;
      text-align: left;
      background-color: #333333;
      float: none;
      }
      .navbar .dropdown-content a:hover {
      background-color: #000000;
      color: #ffff00;
      }
      .navbar .dropdown:hover .dropdown-content {
      display: block;
      }

      .toolbar {
      display: inline-block;
      color: white;
      vertical-align: top;
      font-size: small;
      }
      .toolbar ul {
      display: inline;
      list-style-type: none;
      overflow: hidden;
      }
      .toolbar li {
      float: left;
      padding: 0.65em 0.3em;
      color: white;
      }
      .toolbar li:hover {
      background-color: #333333; 
      color: red;
      cursor: pointer;
      }

      #fileinfo {
      font-family: Mono;
      font-size: x-small;
      padding: 1em 0.4em;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      border-bottom: 1px solid #000000;
      }

      /* Middle panel: containing #image_panel, #leftsidebar */
      .middle_panel {
      display: table;
      width: 100%;
      font-family: Sans;
      font-size: x-small;
      z-index: 1;
      padding-top: 1em;
      }
      #leftsidebar {
      display: inline-block;
      width: 200px;
      z-index: 10;
      border: 1px solid #000000;
      vertical-align: top;
      }
      #display_area {
      display: table-cell;
      width: 100%;
      z-index: 1;
      margin: 0;
      padding-left: 2em;
      vertical-align: top;
      }
      #canvas_panel {
      position: relative;
      margin: 0;
      padding: 0;
      }

      /* Left sidebar accordion */
      button.leftsidebar_accordion {
      font-family: Sans;
      font-size: x-small;
      background-color: #f2f2f2;
      cursor: pointer;
      padding: 0.5em 0.5em;
      width: 100%;
      text-align: left;
      border: none;
      outline: none;
      }
      button.leftsidebar_accordion.active, button.leftsidebar_accordion:hover {
      background-color: #e6e6e6;
      }
      button.leftsidebar_accordion:after {
      content: '\02795';
      color: #4d4d4d;
      float: right;
      }
      button.leftsidebar_accordion.active:after {
      content: '\2796';
      }      
      .leftsidebar_accordion_panel {
      display: none;
      padding-top: 0;
      padding-left: 0.5em;
      }
      .leftsidebar_accordion_panel.show {
      display: block;
      }
      
      /* Region shape selection panel inside leftsidebar */
      ul.region_shape {
      font-size: xx-large;
      list-style-type: none;
      overflow: hidden;
      padding: 0.4em 0;
      margin: 0;
      }
      ul.region_shape li{
      float: left;
      padding: 0 0.3em;
      }
      ul.region_shape li:hover {
      color: red;
      cursor: pointer;
      }
      ul.region_shape .selected {
      color: blue;
      }
      
      /* Loaded image list shown in leftsidebar panel */
      #img_list_panel {
      width: 98%;
      }
      #img_list_panel ul {
      position: relative;
      line-height: 1.2em;
      padding-left: 0.5em;
      list-style-type: none;
      }
      #img_list_panel li {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      }
      #img_list_panel li:hover {
      background-color: #cccccc;
      color: #000000;
      cursor: pointer;
      }

      /* Bottom Panel : contains status messages, attributes input panel */
      .bottom_panel {
      display: table;
      width: 100%;
      font-family: Sans;
      font-size: x-small;
      background-color: #ff0000;
      color: white;
      z-index: 1;
      }
      
      #message_panel {
      position: fixed;
      left: 0;
      bottom: 0px;
      line-height: 3em;
      width: 100%;
      background-color: #333333;
      color: #ffff00;
      font-size: small;
      font-family: Mono;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      z-index: 1000;
      }
      
      #invisible_file_input {
      width: 0.1px;
      height: 0.1px;
      opacity: 0;
      overflow: hidden;
      position: absolute;
      z-index: -1;
      }

      #about_panel {
      display: none;
      margin: auto;
      width: 80%;
      font-family: Sans;
      font-size: 1em;
      line-height: 1.5em;
      margin: 0;
      }
      #about_panel li {
      margin: 1em 0;
      }
      
      .action_text_link {
      background-color: #aaeeff;
      color: #000000;
      }
      .action_text_link:hover {
      cursor: pointer;
      }

      .svg_button:hover {
      cursor: pointer;
      }

      .button {
      color: blue;
      cursor: pointer;
      }

      /* image info (on top right corner) */
      #image_info {
      display: inline;
      position: relative;
      color: yellow;
      font-family: Mono;
      font-size: small;
      top: 1em;
      left: 6em;
      }

      /* region and file attributes input panel (spreadsheet like) */
      #attributes_input_panel {
      display: none;
      position: fixed;
      z-index: 10;
      bottom: 0;
      width: 100%;
      max-height: 40%;
      overflow: auto;
      background-color: #ffffff;
      border-top: 4px solid #000000;
      padding-bottom: 2em;
      }
      #attributes_input_panel .title {
      font-family: Sans;
      font-size: large;
      padding-top: 1em;
      padding-bottom: 0.2em;
      padding-left: 0.8em;
      padding-right: 1em;
      }

      #attributes_input_panel table {
      border-collapse: collapse;
      table-layout: fixed;
      /*width: 100%;*/
      font-size: small;
      margin: 1em;
      }

      #attributes_input_panel td {
      border: 1px solid #e6e6e6;
      padding: 0 0.1em;
      margin: 0;
      height: 1em;
      }
      #attributes_input_panel tr:first-child td, #attributes_input_panel td:first-child {
      padding: 0 1em;
      text-align: center;
      }
      #attributes_input_panel input {
      border: none;
      padding: 0;
      margin: 0;
      display: table-cell;
      width: 100%;
      height: 1.4em;
      font-family: Mono;
      font-size: small;
      }
      #attributes_input_panel input:hover {
      background-color: #e6e6e6;
      }
      #attributes_input_panel input:focus {
      background-color: #e6e6e6;
      }
      #attributes_input_panel input:not(:focus) {
      text-align: center;
      }
      #panel_close_button {
      display: inline-block;
      color: #808080;
      float: right;
      font-size: 2em;
      font-weight: bold;
      padding-right: 0.5em;
      }
      #panel_close_button:hover {
      color: red;
      text-decoration: none;
      cursor: pointer;
      }

      /* layers of canvas */
      #image_panel {
      position: relative;
      display: inline-block;
      margin: auto;
      margin-top: 1em;
      }
      #image_canvas {
      position: absolute;
      top: 0px;
      left: 0px;
      z-index: 1;
      }
      #region_canvas {
      position: absolute;
      top: 0px;
      left: 0px;
      z-index: 2;
      }

    </style>
  </head>

  <body onload="main()" onresize="update_ui_components()">
    <div class="top_panel" id="ui_top_panel">
      <!-- Navigation menu -->
      <div class="navbar">
        <ul> 
          <li><a onclick="show_home_panel()" title="Home">Home</a></li>
          <li class="dropdown"><a title="Image" class="drop_menu_item">Image &#9662;</a>
            <div class="dropdown-content">
	      <a onclick="sel_local_images()" title="Load (or add) a set of images from local disk">Load or Add Images</a>
	      <a onclick="show_img_list()" title="Browse currently loaded images">Show Loaded Image List</a>
            </div>
          </li>
          <li class="dropdown"><a title="Annotations" class="drop_menu_item">Annotation &#9662;</a>
            <div class="dropdown-content">
	      <a onclick="download_all_region_data('csv')" title="Save image region annotations as a CSV(comma separated value) file">Save as CSV</a>
	      <a onclick="download_all_region_data('json')" title="Save image region annotations as a JSON(Javascript Object Notation) file">Save as JSON</a>
	      <a onclick="sel_local_data_file('annotations')" title="Import existing region data from CSV or JSON file">Import</a>
            </div>
          </li>
          <li class="dropdown"><a onclick="show_about_panel()" title="Help">Help &#9662;</a>
            <div class="dropdown-content">
	      <a onclick="show_about_panel()" title="About VGG Image Annotator (VIA)">About VIA</a>
            </div>
          </li>
        </ul>

      </div> <!-- end of #navbar -->

      <!-- Shortcut toolbar -->
      <div class="toolbar">
	<ul>
	  <li onclick="sel_local_images()" title="Load/Add Images">&ctdot;</li>
	  <li onclick="sel_local_data_file('annotations')" title="Import Annotations">&darr;</li>
	  <li onclick="" title="Save Annotations">&DownArrowBar;</li>
	  
	  <li style="margin-left: 2em;" onclick="move_to_prev_image()" title="Previous Image">&larr;</li>
	  <li onclick="move_to_next_image()" title="Next Image">&rarr;</li>
	  <li onclick="toggle_img_list()" title="List Images">&#9776;</li>

	  <li style="margin-left: 2em;" onclick="zoom_out()" title="Zoom Out">&minus;</li>
	  <li onclick="zoom_in()" title="Zoom In">&plus;</li>
	  <li onclick="reset_zoom_level()" title="Zoom Reset">&equals;</li>

	  <li style="margin-left: 2em;" onclick="" title="Copy Region">c</li>
	  <li onclick="" title="Paste Region">v</li>
	  <li onclick="" title="Select All Regions">a</li>
	  <li onclick="" title="Delete Region">&times;</li>
	</ul>
      </div> <!-- endof #toolbar -->
      <input type="file" id="invisible_file_input" multiple name="files[]" style="display:none">
    </div> <!-- endof #top_panel -->

    <!-- Middle Panel contains a left-sidebar and image display areas -->
    <div class="middle_panel">
      <div id="leftsidebar">
	<div id="fileinfo"></div> <!-- endof #fileinfo -->
	
	<button onclick="toggle_accordion_panel(this)" class="leftsidebar_accordion active">Region Shape</button>
	<div class="leftsidebar_accordion_panel show" id="accordion_region_shape_panel">
	  <ul class="region_shape">
	    <li id="region_shape_rect" class="selected" onclick="select_region_shape('rect')" title="Rectangle">&EmptySmallSquare;</li>
	    <li id="region_shape_circle" onclick="select_region_shape('circle')" title="Circle">&cir;</li>
	    <li id="region_shape_ellipse" onclick="select_region_shape('ellipse')" title="Ellipse">0</li>
	    <li id="region_shape_polygon" onclick="select_region_shape('polygon')" title="Polygon">&trpezium;</li>
	  </ul>
	</div>

	<button onclick="toggle_region_attributes_panel()" class="leftsidebar_accordion">Region Attributes (3)</button>
	<div class="leftsidebar_accordion_panel" id="accordion_region_attr_panel"></div>
	
	<button onclick="toggle_file_attributes_panel()" class="leftsidebar_accordion">File Attributes (0)</button>
	<div class="leftsidebar_accordion_panel" id="accordion_file_attr_panel"></div>

	<button onclick="toggle_accordion_panel(this)" class="leftsidebar_accordion">Keyboard Shortcuts</button>
	<div class="leftsidebar_accordion_panel">
	  <table style="padding: 1em 0;">
            <tr>
              <td style="width: 7em;">n/p (&larr;/&rarr;)</td>
              <td>Next/Previous image</td>
            </tr>
            <tr>
              <td>Spc</td>
              <td>Show/hide attributes</td>
            </tr>
            <tr>
              <td>Ctrl + Spc</td>
              <td>Show/hide image list</td>
            </tr>
            <tr>
              <td>+/-/=</td>
              <td>Zoom in/out/reset</td>
            </tr>
            <tr>
              <td>Ctrl + s</td>
              <td>Download annotations</td>
            </tr>
            <tr>
              <td>Ctrl + a</td>
              <td>Select all regions</td>
            </tr>
            <tr>
              <td>Ctrl + c</td>
              <td>Copy sel. regions</td>
            </tr>           
            <tr>
              <td>Ctrl + v</td>
              <td>Paste sel. regions</td>
            </tr>
            <tr>
              <td>Esc</td>
              <td>Cancel operation</td>
            </tr>
            <tr>
              <td>Alt + d, Del</td>
              <td>Delete image region</td>
            </tr>           
          </table>
	</div>

	<button onclick="toggle_img_list(this)" class="leftsidebar_accordion" id="image_list_panel_button">Image List</button>
	<div id="img_list_panel"></div>
      </div>

      <!-- Main display area: contains image canvas, ... -->
      <div id="display_area">
	<div id="canvas_panel">
          <canvas id="image_canvas"></canvas>
	  <canvas id="region_canvas">Sorry, your browser does not support HTML5 Canvas functionality which is required for this application.</canvas>
	</div>

	<div id="text_panel">
	  <div id="via_start_info_panel">
            <p>To begin the image annotation process,
	      click <a title="Load images" style="cursor: pointer;" onclick="load_images()">Load images</a>
	      in the Image menu.</p>
          </div>

	  <div id="getting_started_panel">@todo</div>
	  
	  <div id="about_panel">
            <p>
              VGG Image Annotator (via) is an <a href="https://gitlab.com/vgg/via/">open source project</a> 
              developed at the <a href="http://www.robots.ox.ac.uk/~vgg/">Visual Geometry Group</a> 
              and released under the BSD-2 clause <a href="https://gitlab.com/vgg/via/blob/master/LICENSE">license</a>.
              With this standalone application, you can define regions in an image and create a textual description of those regions.
              Such image regions and descriptions are useful for supervised training of learning algorithms.
            </p>
            <p>
              Features:
              <ul>
		<li>based solely on HTML, CSS and Javascript (no dependecies on any javascript libraries)</li>
		<li>can be used offline (complete application packaged in a single html file of size &lt; 200KB)</li>
		<li>requires nothing more than a modern web browser (tested on firefox and chrome)</li>
		<li>supports following region shapes: rectangle, circle, ellipse, polygon</li>
		<li>supports multiple attributes for each image region</li>
		<li>import (and export) of region data from (to) text file in csv and json format</li>
		<li>hundreds of images can be loaded and annotated with any performance degradation</li>
              </ul>
            </p>
            <p>For more details, visit <a href="http://www.robots.ox.ac.uk/~vgg/software/via/">http://www.robots.ox.ac.uk/~vgg/software/via/</a></p>
          </div>  
	</div>
      </div>
    </div>

    <!-- Bottom panel is used to display attributes input panel -->    
    <div class="bottom_panel">
      <div id="attributes_input_panel"></div>
    </div>

    <!-- to show status messages -->
    <div id="message_panel"></div>

    <script type="text/javascript" src="via_demo.js">
    <script type="text/javascript">
      <!--AUTO_INSERT_VIA_DEMO_JS_HERE-->
    </script>
    <script type="text/javascript" src="via.js">
    <script type="text/javascript">
      <!--AUTO_INSERT_VIA_JS_HERE-->
    </script>
  </body>
</html>
