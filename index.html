<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"> 
    <!--
        VGG Image Annotator (via)
        www.robots.ox.ac.uk/~vgg/software/via/

        Copyright (c) 2016, Abhishek Dutta.
        All rights reserved.

        Redistribution and use in source and binary forms, with or without
        modification, are permitted provided that the following conditions are met:

        Redistributions of source code must retain the above copyright notice, this
        list of conditions and the following disclaimer.
        Redistributions in binary form must reproduce the above copyright notice,
        this list of conditions and the following disclaimer in the documentation
        and/or other materials provided with the distribution.
        THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
        AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
        IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
        ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
        LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
        CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
        SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
        INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
        CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
        ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
        POSSIBILITY OF SUCH DAMAGE.

      -->
    <title>VGG Image Annotator (VIA)</title>
    <meta name="author" content="Abhishek Dutta">
    <meta name="description" content="VIA is a standalone image annotator application packaged as a single HTML file (< 200 KB) that runs on most modern web browsers.">

    <!-- Google analytics : used in Seebibyte project to measure impact
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-20555581-2', 'auto');
      ga('send', 'pageview');

    </script>
    -->
    
    <!-- CSS style definition -->
    <style type="text/css">     
      body {
      min-width: 800px;
      padding: 0;
      margin: 0;
      margin-bottom: 3em;
      }
      
      #wrapper {
      display: table;
      text-align: center;
      }

      #navbar {
      position: relative;
      top: 0;
      left: 0;
      font-family: Sans;
      display: table;
      height: 1px;
      background: #000000;
      width: 100%;
      z-index: 1;
      }
      
      #navbar ul {
      display: inline;
      font-size: medium;
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #333;
      }

      #navbar li {
      float: left;
      }

      #navbar li a, .drop_menu_item {
      display: inline-block;
      color: white;
      text-align: center;
      padding: 1em 1.2em;
      text-decoration: none;
      }

      #navbar li a:hover, .dropdown:hover .drop_menu_item {
      background-color: #999999;
      cursor: pointer;
      }

      #navbar li.dropdown {
      display: inline-block;
      }

      #navbar .dropdown-content {
      display: none;
      position: absolute;
      background-color: #333333;
      min-width: 160px;
      border: 1px solid #ffffff;
      }

      #navbar .dropdown-content a {
      color: #ffffff;
      padding: 0.4em 0.6em;
      text-decoration: none;
      font-size: small;
      display: block;
      text-align: left;
      background-color: #333333;
      float: none;
      }

      #navbar .dropdown-content a:hover {
      background-color: #000000;
      color: #ffff00;
      }

      #navbar .dropdown:hover .dropdown-content {
      display: block;
      }

      .main {
      display: table;
      width: 100%;
      }

      .box {
      display: table-cell;
      padding: 1em 0;
      vertical-align: top;
      }

      .box canvas {
      position: relative;
      }

      /* Panel in the left hand side of image canvas */
      .sidebar {
      font-family: Mono;
      font-size: small;
      /*width: 250px;*/
      padding: 1em 1em;
      vertical-align: top;
      }
      .sidebar .title {
      font-family: Sans;
      font-size: large;
      padding-top: 1em;
      padding-bottom: 0.5em;
      }
      .sidebar .info table {
      border-collapse: collapse;
      table-layout: fixed;
      min-width: 250px;
      max-width: 400px;
      }
      .sidebar .info table, td {
      border: 1px solid #cccccc;
      padding: 0 0.4em;
      line-height: 2em;
      overflow: hidden;
      text-overflow: ellipsis;
      }

      /* Toolbar to select region shape */
      .region_shape {
      display: inline-block;
      stroke: #333333;
      fill: #cccccc;
      background-color: #ffffff;
      padding: 0 0.5em;
      }
      .region_shape:hover {
      fill: #ff0000;
      cursor: pointer;
      }
      .region_shape_selected {
      background-color: #e5e5e5;
      }
      .region_shape_selected:hover {
      fill: #cccccc;
      }
      
      
      #message_panel {
      position: fixed;
      left: 0;
      bottom: 0px;
      line-height: 3em;
      width: 100%;
      background-color: #333333;
      color: #ffff00;
      font-size: small;
      font-family: Mono;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      z-index: 1000;
      }
      
      #annotation_textarea {
      display: none;
      }

      #invisible_file_input {
      width: 0.1px;
      height: 0.1px;
      opacity: 0;
      overflow: hidden;
      position: absolute;
      z-index: -1;
      }
      #image_panel {
      display: inline-block;
      margin: auto;
      }
      #about_panel {
      display: inline-block;
      margin: auto;
      width: 80%;
      font-family: Sans;
      font-size: 1em;
      line-height: 1.5em;
      margin: 0;
      }
      #about_panel li {
      margin: 1em 0;
      }
      
      .action_text_link {
      background-color: #aaeeff;
      color: #000000;
      }
      .action_text_link:hover {
      cursor: pointer;
      }

      /* for updating attribute values */
      .clickable_tbl_entry {
      background-color: #ffffff;
      color: #000000;
      }
      .clickable_tbl_entry:hover {
      background-color: #cccccc;
      color: #000000;
      cursor: pointer;
      }

      .svg_button:hover {
      cursor: pointer;
      }
      .header_cell {
      background-color: #e6e6e6;
      }

      /* image info (on top right corner) */
      #image_info {
      display: inline;
      position: relative;
      color: yellow;
      font-family: Mono;
      font-size: small;
      top: 1em;
      left: 6em;
      }

      /* loaded image list */
      #loaded_img_list_panel {
      height: 92%;
      width: 0;
      position: fixed;
      z-index: 10000;
      top: 51px;
      right: 0;
      background-color: #e6e6e6;
      overflow: scroll;
      transition: 0.5s;
      font-family: Mono;
      font-size: small;
      padding-top: 1em;
      padding-bottom: 1em;
      padding-left: 0.4em;
      }
      #loaded_img_list_panel ul {
      float: left;
      line-height: 1.2em;
      padding-left: 0;
      list-style-type: none;
      }
      #loaded_img_list_panel li:hover {
      background-color: #cccccc;
      color: #000000;
      cursor: pointer;
      }

      /* region and file attributes input panel (spreadsheet like) */
      #small_attributes_input_panel {
      width: 300px;
      overflow: scroll;
      }
      #small_attributes_input_panel table {
      border-collapse: collapse;
      table-layout: fixed;
      font-size: small;
      margin: 1em;
      }

      #attributes_input_panel {
      display: none;
      position: fixed;
      z-index: 2;
      bottom: 0;
      width: 100%;
      overflow: auto;
      background-color: #ffffff;
      border-top: 4px solid #000000;
      padding-bottom: 2em;
      }
      #attributes_input_panel .title {
      font-family: Sans;
      font-size: large;
      padding-top: 1em;
      padding-bottom: 0.2em;
      padding-left: 0.8em;
      padding-right: 1em;
      }

      #attributes_input_panel table {
      border-collapse: collapse;
      table-layout: fixed;
      /*width: 100%;*/
      font-size: small;
      margin: 1em;
      }

      #attributes_input_panel td {
      border: 1px solid #e6e6e6;
      padding: 0 0.1em;
      margin: 0;
      height: 1em;
      }
      #attributes_input_panel tr:first-child td, #attributes_input_panel td:first-child {
      padding: 0 1em;
      text-align: center;
      }
      #attributes_input_panel input {
      border: none;
      padding: 0;
      margin: 0;
      display: table-cell;
      width: 100%;
      height: 1.4em;
      font-family: Mono;
      font-size: small;
      }
      #attributes_input_panel input:hover {
      background-color: #e6e6e6;
      }
      #attributes_input_panel input:focus {
      background-color: #e6e6e6;
      }
      #attributes_input_panel input:not(:focus) {
      text-align: center;
      }
      #panel_close_button {
      display: inline-block;
      color: #808080;
      float: right;
      font-size: 2em;
      font-weight: bold;
      padding-right: 0.5em;
      }
      #panel_close_button:hover {
      color: red;
      text-decoration: none;
      cursor: pointer;
      }

    </style>
  </head>

  <body onload="main()" onresize="update_ui_components()">
    <!-- Start: Definition SVG for icons -->
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <defs>
        <symbol id="via_logo">
          <title>VGG Image Annotator Logo</title>
          <rect width="38" height="22" x="20" y="-50" transform="matrix(0,1,-1,0,0,0)" />
          <rect width="38" height="22" x="12" y="-36" transform="matrix(0,1,-1,0,0,0)" />
          <rect width="38" height="22" x="6" y="-45" transform="matrix(0,1,-1,0,0,0)" />
        </symbol>

        <symbol id="icon_img_list">
          <title>Show image list</title>
          <rect x="2" y="10" width="30" height="2"/>
          <rect x="2" y="20" width="30" height="2"/>
          <rect x="2" y="30" width="30" height="2"/>
        </symbol>
        <symbol id="icon_plus">
          <title>Plus</title>
          <path d="M31 12h-11v-11c0-0.552-0.448-1-1-1h-6c-0.552 0-1 0.448-1 1v11h-11c-0.552 0-1 0.448-1 1v6c0 0.552 0.448 1 1 1h11v11c0 0.552 0.448 1 1 1h6c0.552 0 1-0.448 1-1v-11h11c0.552 0 1-0.448 1-1v-6c0-0.552-0.448-1-1-1z"></path>
        </symbol>
        <symbol id="icon_import">
          <title>Import</title>
          <path d="M16 31l15-15h-9v-16h-12v16h-9z"></path>
        </symbol>

        <symbol id="shape_rectangle">
          <title>Rectangular region shape</title>
          <rect width="20" height="12" x="6" y="10" />
        </symbol>
        <symbol id="shape_circle">
          <title>Circular region shape</title>
          <circle r="10" cx="16" cy="16" />
        </symbol>
        <symbol id="shape_ellipse">
          <title>Elliptical region shape</title>
          <ellipse rx="12" ry="8" cx="16" cy="16" />
        </symbol>
        <symbol id="shape_polygon">
          <title>Polyline region shape</title>
          <path d="M 15.25,2.2372 3.625,11.6122 6,29.9872 l 20.75,-9.625 2.375,-14.75 z" />
        </symbol>

        <symbol id="icon_resize" viewBox="0 0 32 32">
          <title>Expand/Contract</title>
          <path class="path1" d="M30 0h2v16h-2v-16z"></path>
          <path class="path2" d="M0 16h2v16h-2v-16z"></path>
          <path class="path3" d="M10 22h22v4h-22v5l-7-7 7-7v5z"></path>
          <path class="path4" d="M22 10h-22v-4h22v-5l7 7-7 7z"></path>
        </symbol>
        <symbol id="icon_table" viewBox="0 0 32 32">
          <title>Table</title>
          <path class="path1" d="M0 2v28h32v-28h-32zM12 20v-6h8v6h-8zM20 22v6h-8v-6h8zM20 6v6h-8v-6h8zM10 6v6h-8v-6h8zM2 14h8v6h-8v-6zM22 14h8v6h-8v-6zM22 12v-6h8v6h-8zM2 22h8v6h-8v-6zM22 28v-6h8v6h-8z"></path>
        </symbol>
        
      </defs>
    </svg>
    <!-- End: Define SVG for icons -->

    <div class="wrapper">
      <div id="navbar">
        <ul> 
          <li><a onclick="show_home_panel()" title="Home">Home</a></li>
          <li class="dropdown"><a title="Image" class="drop_menu_item">Image &#9662</a>
            <div class="dropdown-content">
              <a onclick="load_images()" title="Load (or add) a set of images from local disk">Load or Add Images</a>
              <a onclick="show_img_list()" title="Browse currently loaded images">Show Loaded Image List</a>
            </div>
          </li>
          <li class="dropdown"><a title="Annotations" class="drop_menu_item">Annotation &#9662</a>
            <div class="dropdown-content">
              <a onclick="download_all_region_data('csv')" title="Save image region annotations as a CSV(comma separated value) file">Save as CSV</a>
              <a onclick="download_all_region_data('json')" title="Save image region annotations as a JSON(Javascript Object Notation) file">Save as JSON</a>
              <a onclick="upload_region_data_file()" title="Import existing region data from CSV or JSON file">Import</a>
            </div>
          </li>
          <li class="dropdown"><a title="Attributes" class="drop_menu_item">Attributes &#9662</a>
            <div class="dropdown-content">
              <a onclick="save_attributes()" title="Save image region attributes to a local file">Save attributes</a>
              <a onclick="import_attributes()" title="Import existing attributes from a file">Import attributes</a>
              <a onclick="delete_all_attributes()" title="Delete all attributes">Delete attributes</a>
            </div>
          </li>
          <li class="dropdown"><a onclick="show_about_panel()" title="Help">Help &#9662</a>
            <div class="dropdown-content">
              <a href="https://gitlab.com/vgg/via/issues/new" target="_new" title="Report issues about this application">Report issue</a>
              <a onclick="show_about_panel()" title="Import existing attributes from a file">About via</a>
            </div>
          </li>
        </ul>

        <div id="image_info">
          <div style="display: inline-block; fill: white; stroke: white;" ><a onclick="toggle_img_list()" title="Browse currently loaded images" class="svg_button"><svg width="18" viewBox="0 0 32 32"><use xlink:href="#icon_img_list"></use></svg></a></div>
          <span id="info_current_fileid"></span> <span id="info_current_filename"><span class="action_text_link" onclick="load_images()" title="Import existing attributes from a file">[click to load images]</span></span>

          <span id="info_region" style="display: none;"></span>
          <span id="info_attribute" style="display: none;"></span>
        </div>

        <input type="file" id="invisible_file_input" multiple name="files[]" style="display:none">
      </div> <!-- end of navbar -->

      <div class="main">
        <div class="box sidebar" id="info_panel">
          <div class="title">Select Region Shape</div>
          <div>
            <div class="region_shape region_shape_selected" onclick="select_region_shape('rect')" id="region_shape_rect" title="To draw rectangular region"><svg height="32" viewbox="0 0 32 32"><use xlink:href="#shape_rectangle"></use></svg></div>
            <div class="region_shape" onclick="select_region_shape('circle')" id="region_shape_circle" title="To draw circular region"><svg height="32" viewbox="0 0 32 32"><use xlink:href="#shape_circle"></use></svg></div>
            <div class="region_shape" onclick="select_region_shape('ellipse')" id="region_shape_ellipse" title="To draw elliptical region"><svg height="32" viewbox="0 0 32 32"><use xlink:href="#shape_ellipse"></use></svg></div>
            <div class="region_shape" onclick="select_region_shape('polygon')" id="region_shape_polygon" title="To draw polygon region"><svg height="32" viewbox="0 0 32 32"><use xlink:href="#shape_polygon"></use></svg></div>
          </div>

          <!-- Show Region and File attributes panel -->
          <div class="title">File/Region Attributes</div>
          <span class="action_text_link" onclick="toggle_attributes_input_panel()" title="Show/Hide attributes">[click to show/hide attributes]</span>
          
          <div class="title">Keyboard Shortcuts</div>
          <div class="info">
            <table>
              <tr>
                <td style="width: 6em;">Alt + d</td>
                <td>Delete image region</td>
              </tr>
              <tr>
                <td>n/p (&larr;/&rarr;)</td>
                <td>Next/Previous image</td>
              </tr>
              <tr>
                <td>Ctrl + o</td>
                <td>Load or add images</td>
              </tr>
              <tr>
                <td>Ctrl + s</td>
                <td>Download region data</td>
              </tr>
              <tr>
                <td>Ctrl + i</td>
                <td>Import region data</td>
              </tr>
              <tr>
                <td>Ctrl + l</td>
                <td>Browse loaded image</td>
              </tr>
              <tr>
                <td>Ctrl + a</td>
                <td>Select all regions</td>
              </tr>
              <tr>
                <td>Ctrl + c</td>
                <td>Copy sel. regions</td>
              </tr>           
              <tr>
                <td>Ctrl + v</td>
                <td>Paste sel. regions</td>
              </tr>
              <tr>
                <td>Esc</td>
                <td>Cancel operation</td>
              </tr>
            </table>
          </div>
        </div>
        
        <div class="box" id="image_panel">
          <canvas id="image_canvas">Sorry, your browser does not support HTML5 Canvas functionality which is required for this application.</canvas>

          <div id="via_start_info_panel">
            <p>To begin the image annotation process, click <a title="Load images" style="cursor: pointer;" onclick="load_images()">Load images</a> in the Image menu.
          </div>

          <div id="img_list_panel"></div>

          <div class="" id="about_panel" style="">
            <p>
              VGG Image Annotator (via) is an <a href="https://gitlab.com/vgg/via/">open source project</a> 
              developed at the <a href="http://www.robots.ox.ac.uk/~vgg/">Visual Geometry Group</a> 
              and released under the BSD-2 clause <a href="https://gitlab.com/vgg/via/blob/master/LICENSE">license</a>.
              With this standalone application, you can define regions in an image and create a textual description of those regions.
              Such image regions and descriptions are useful for supervised training of learning algorithms.
            </p>
            <p>
              Features:
            <ul>
              <li>based solely on HTML, CSS and Javascript (no dependecies on any javascript libraries)</li>
              <li>can be used offline (complete application packaged in a single html file of size &lt; 200KB)</li>
              <li>requires nothing more than a modern web browser (tested on firefox and chrome)</li>
              <li>supports following region shapes: rectangle, circle, ellipse, polygon</li>
              <li>supports multiple attributes for each image region</li>
              <li>import (and export) of region data from (to) text file in csv and json format</li>
              <li>hundreds of images can be loaded and annotated with any performance degradation</li>
            </ul>
            </p>
            <p>For more details, visit <a href="www.robots.ox.ac.uk/~vgg/software/via/">www.robots.ox.ac.uk/~vgg/software/via/</a></p>
          </div>
          
        </div>
        <div id="loaded_img_list_panel"></div>
      </div> <!-- end of main -->
    </div> <!-- end of wrapper -->
    <div id="message_panel"></div>
    
    <div id="attributes_input_panel">
      <span id="panel_close_button" onclick="toggle_attributes_input_panel()">&times</span>

      <!-- Region Attributes -->
      <div>
        <div style="display: inline-block;" class="title">Regions Attributes</div>
        <div style="display: inline-block;" ><a onclick="toggle_table_width('region_attr_table')" title="Change table width (100% or auto)" class="svg_button"><svg width="12" viewBox="0 0 32 32"><use xlink:href="#icon_resize"></use></svg></a></div>
        <div style="display: inline-block;" ><a onclick="toggle_table_layout('region_attr_table')" title="Change table layout (fixed or auto)" class="svg_button"><svg width="12" viewBox="0 0 32 32"><use xlink:href="#icon_table"></use></svg></a></div>
      </div>
      <table id="region_attr_table"></table>

      <!-- File Attributes -->
      <div>
        <div style="display: inline-block;" class="title">File Attributes</div>
        <div style="display: inline-block;" ><a onclick="toggle_table_width('file_attr_table')" title="Change table width (100% or auto)" class="svg_button"><svg width="12" viewBox="0 0 32 32"><use xlink:href="#icon_resize"></use></svg></a></div>
        <div style="display: inline-block;" ><a onclick="toggle_table_layout('file_attr_table')" title="Change table layout (fixed or auto)" class="svg_button"><svg width="12" viewBox="0 0 32 32"><use xlink:href="#icon_table"></use></svg></a></div>
      </div>
      <table id="file_attr_table"></table>
    </div>
    
    <script type="text/javascript" src="via_demo.js">
      <!--AUTO_INSERT_VIA_DEMO_JS_HERE-->
    </script>
    <script type="text/javascript" src="via.js">
      <!--AUTO_INSERT_VIA_JS_HERE-->
    </script>
  </body>
</html>
